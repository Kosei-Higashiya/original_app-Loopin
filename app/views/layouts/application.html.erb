<!DOCTYPE html>
<html>
  <head>
    <title>Loopin - 習慣管理アプリ</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="習慣形成をサポートする「Loopin」。バッジ機能やカレンダー表示で、あなたの目標達成を手助けします。">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= favicon_link_tag "/favicon-32x32.png", type: "image/png" %>

    <%# OGP (Open Graph Protocol) meta tags %>
    <meta property="og:title" content="Loopin - 習慣管理アプリ">
    <meta property="og:description" content="習慣形成をサポートする「Loopin」。バッジ機能やカレンダー表示で、あなたの目標達成を手助けします。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= request.original_url %>">
    <meta property="og:image" content="<%= request.base_url %>/ogp.png">
    <meta property="og:site_name" content="Loopin">
    <meta property="og:locale" content="ja_JP">

    <%# Twitter Card meta tags %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Loopin - 習慣管理アプリ">
    <meta name="twitter:description" content="習慣形成をサポートする「Loopin」。バッジ機能やカレンダー表示で、あなたの目標達成を手助けします。">
    <meta name="twitter:image" content="<%= request.base_url %>/ogp.png">
    <%= stylesheet_link_tag "application.tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-200R80HTX0"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-200R80HTX0');
  </script>

  </head>

  <body>
    <div id="flash-messages" class="max-w-7xl mx-auto px-4">
    <% flash.each do |key, message| %>
      <div class="bg-<%= ['notice', 'success'].include?(key.to_s) ? 'green' : 'red' %>-100 border-<%= ['notice', 'success'].include?(key.to_s) ? 'green' : 'red' %>-400 text-<%= ['notice', 'success'].include?(key.to_s) ? 'green' : 'red' %>-700 px-5 py-3 my-3 rounded-lg border relative flex items-center justify-between font-medium shadow-sm" role="alert">
        <%= message %>
        <button type="button" class="absolute top-1/2 right-4 -translate-y-1/2 bg-transparent border-0 text-lg cursor-pointer opacity-60 hover:opacity-100 focus:outline-2 focus:outline-blue-500 focus:outline-offset-2 font-bold px-2 py-1 min-w-[20px] min-h-[20px] flex items-center justify-center" aria-label="Close">×</button>
      </div>
    <% end %>
    </div>
    <header class="bg-white shadow-sm sticky top-0 z-[100]">
       <nav class="py-4" data-controller="navbar" data-turbo-permanent>
        <div class="max-w-7xl mx-auto px-5 flex justify-between items-center relative">
          <%= link_to root_path, class: "no-underline flex items-center" do %>
            <%= image_tag "logo.svg", alt: "Loopin", class: "h-10 w-auto" %>
          <% end %>
          <button class="hidden bg-transparent border-0 cursor-pointer p-2 z-[101] md:hidden" data-navbar-target="toggler" data-action="click->navbar#toggle" aria-label="メニュー">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="flex items-center gap-8 md:hidden md:absolute md:top-full md:left-0 md:right-0 md:bg-white md:flex-col md:gap-0 md:py-4 md:shadow-md md:border-t md:border-gray-200" data-navbar-target="menu">
            <%= link_to "使い方", how_to_use_path, class: "no-underline text-gray-600 font-medium transition-colors duration-300 hover:text-indigo-600 md:py-3 md:px-6 md:w-full md:text-left md:border-b md:border-gray-100" %>
            <% if user_signed_in? %>
              <%= link_to "ログアウト", destroy_user_session_path, "data-turbo-method": :delete, class: "no-underline text-gray-600 font-medium transition-colors duration-300 hover:text-indigo-600 md:py-3 md:px-6 md:w-full md:text-left md:border-b md:border-gray-100" %>
              <%= link_to "プロフィール", edit_user_registration_path, class: "no-underline text-gray-600 font-medium transition-colors duration-300 hover:text-indigo-600 md:py-3 md:px-6 md:w-full md:text-left" %>
            <% else %>
              <%= link_to "ログイン", new_user_session_path, class: "no-underline text-gray-600 font-medium transition-colors duration-300 hover:text-indigo-600 md:py-3 md:px-6 md:w-full md:text-left md:border-b md:border-gray-100" %>
              <%= link_to "新規登録", new_user_registration_path, class: "bg-indigo-600 text-white px-4 py-2 rounded-md transition-colors duration-300 hover:bg-indigo-800 md:mx-6 md:my-2 md:text-center md:block" %>
            <% end %>
          </div>
        </div>
      </nav>
    </header>

    <main class="min-h-[calc(100vh-200px)]">
      <%= yield %>
    </main>

    <footer class="bg-gray-800 text-white py-8 text-center">
      <div class="max-w-7xl mx-auto px-5">
        <p class="opacity-80">&copy; 2025 Loopin. All rights reserved.</p>
        <div class="mt-4 flex justify-center gap-8">
          <%= link_to "利用規約", page_path("terms"), class: "text-white no-underline opacity-80 transition-opacity duration-200 hover:opacity-100 hover:underline" %>
          <%= link_to "プライバシーポリシー", page_path("privacy"), class: "text-white no-underline opacity-80 transition-opacity duration-200 hover:opacity-100 hover:underline" %>
        </div>
      </div>
    </footer>
