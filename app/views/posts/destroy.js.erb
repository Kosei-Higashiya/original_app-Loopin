// Remove the post card from the page
$("#post-<%= @post.id %>").fadeOut(300, function() {
  $(this).remove();

  // Check if there are no more posts and show the "no posts" message
  if ($('.dashboard-card').length === 0) {
    $('.dashboard-grid').html(`
      <div class="text-center py-5">
        <div class="dashboard-card" style="max-width: 500px; margin: 0 auto;">
          <div class="card-header">
            <h3 class="card-title">📝 まだ投稿がありません</h3>
          </div>
          <div class="card-content">
            <p>最初の投稿をして、コミュニティを盛り上げませんか？</p>
            <div class="card-actions">
              <a href="<%= new_post_path %>" class="btn btn-primary">投稿する</a>
            </div>
          </div>
        </div>
      </div>
    `);
  }
});

// Show success message using the flash system
const flashContainer = document.getElementById('flash-messages');
if (flashContainer) {
  const alertDiv = document.createElement('div');
  alertDiv.className = 'alert alert-success alert-dismissible fade show';
  alertDiv.setAttribute('role', 'alert');
  alertDiv.innerHTML = `
    習慣投稿が削除されました。
    <button type="button" class="btn-close" aria-label="Close"></button>
  `;
  
  flashContainer.appendChild(alertDiv);
  
  // Add close button functionality directly
  const closeButton = alertDiv.querySelector('.btn-close');
  if (closeButton) {
    closeButton.addEventListener('click', function() {
      if (alertDiv && alertDiv.parentNode) {
        alertDiv.classList.remove('show');
        alertDiv.style.transition = 'opacity 0.15s linear';
        alertDiv.style.opacity = '0';
        setTimeout(() => {
          if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
          }
        }, 150);
      }
    });
  }
  
  // Auto-dismiss after 5 seconds
  setTimeout(() => {
    if (alertDiv && alertDiv.parentNode) {
      alertDiv.classList.remove('show');
      alertDiv.style.transition = 'opacity 0.15s linear';
      alertDiv.style.opacity = '0';
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.parentNode.removeChild(alertDiv);
        }
      }, 150);
    }
  }, 5000);
} else {
  alert('習慣投稿が削除されました。');
}
