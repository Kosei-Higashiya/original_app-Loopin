# グラフ機能の実装について

## 概要

Chart.jsを使用して、ユーザーの習慣達成状況を可視化するグラフ機能を実装しました。

## 実装した機能

### 1. 日別達成率の折れ線グラフ（直近30日間）
- すべての習慣の達成状況を日別に表示
- Y軸: 達成率（%）
- X軸: 日付（直近30日間）
- 折れ線グラフで推移を視覚的に確認可能

### 2. 習慣別達成率の棒グラフ（直近30日間）
- 各習慣ごとの達成率を表示
- Y軸: 達成率（%）
- X軸: 習慣名
- 棒グラフで各習慣の達成状況を比較可能
- ツールチップで完了日数も表示

## 技術詳細

### 使用技術
- **Chart.js 4.4.0**: グラフ描画ライブラリ（CDN経由で読み込み）
- **importmap-rails**: JavaScriptモジュールの管理
- **Stimulus**: Chart.jsを制御するコントローラー

### ファイル構成

#### コントローラー
- `app/controllers/habits_controller.rb`
  - `graphs` アクションを追加
  - 直近30日間のデータを取得・計算

#### ビュー
- `app/views/habits/graphs.html.erb`
  - グラフ表示用のキャンバス要素
  - Stimulusコントローラーを使用したグラフ初期化

#### JavaScript
- `app/javascript/controllers/chart_controller.js`
  - Chart.jsを使用したグラフ描画のStimulusコントローラー
  - importmap経由でChart.jsをCDNから読み込み

#### インポートマップ
- `config/importmap.rb`
  - Chart.jsとその依存関係をCDNからピン留め
  - Stimulus関連ライブラリの設定

#### ルーティング
- `config/routes.rb`
  - `/habits/graphs` パスを追加（collection route）

### データ計算ロジック

#### 日別達成率の計算
```ruby
# 各日付について
達成率 = (その日に完了した習慣の数 / 総習慣数) × 100
```

#### 習慣別達成率の計算
```ruby
# 各習慣について（直近30日間）
達成率 = (完了した日数 / 30日) × 100
```

## アクセス方法

1. 習慣一覧ページ（`/habits`）にアクセス
2. 「📊 グラフを見る」ボタンをクリック
3. グラフページ（`/habits/graphs`）が表示されます

または、直接 `/habits/graphs` にアクセスすることも可能です。

## セットアップ方法

Chart.jsはCDN経由で自動的に読み込まれるため、特別なビルドプロセスは不要です。

開発サーバーを起動するだけで使用できます：

```bash
./bin/dev  # または foreman start -f Procfile.dev
```

importmap-railsを使用することで：
- ビルドプロセスが不要
- 高速な開発体験
- シンプルな設定


## セキュリティ

- Chart.js 4.4.0は既知の脆弱性がないことを確認済み
- CodeQL静的解析を実行し、セキュリティ上の問題がないことを確認

## テスト

System specを追加して、以下の動作を確認しています：

1. グラフページが正常に表示されること
2. 習慣一覧からグラフページへの遷移が正常に動作すること

テストファイル: `spec/system/habits_spec.rb`

## 今後の拡張可能性

- 期間選択機能（7日間、30日間、90日間など）
- データのエクスポート機能
- グラフの種類を追加（円グラフなど）
- 週別・月別の集計表示
- 比較機能（前月との比較など）
